<!doctype html>
<html>
<head>
  <title>Choropleth using G.js</title>
  <style>
    svg {
      background: #fff;
      border: 1px solid #333;
      width: 35em;
      height: 30em;
    }

    .axis path, .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
  </style>
<body>
  <h1>Choropleth Example using G.js</h1>
  <p>G.js is a gramener written svg visualation toolkit written on top of d3.</p>

  <svg id="india">
  </svg>

  <script src="../../bower_test/bower_components/d3/d3.min.js"></script>
  <script src="topojson.js"></script>
  <script src="g.min.js"></script>
  <script>

  var regionwise = {
    "AN": 1,
    "AP": 29,
    "AS": 12,
    "BH": 46,
    "CG": 24,
    "CH": 9,
    "DH": 401,
    "DN": 1,
    "GJ": 124,
    "HP": 9,
    "HY": 97,
    "JH": 63,
    "JK": 10,
    "KL": 20,
    "KN": 91,
    "LD": 1,
    "MG": 3,
    "MH": 341,
    "MP": 72,
    "NL": 1,
    "OR": 21,
    "PB": 58,
    "PC": 2,
    "RJ": 119,
    "TG": 39,
    "TN": 88,
    "TR": 1,
    "UC": 13,
    "UP": 262,
    "WB": 143,
    "XX": 13,
    "XY": 172
  };
  var regionwise_min = d3.min(d3.values(regionwise));
  var regionwise_max = d3.max(d3.values(regionwise));

  var divisions = 3;
  var legendDimensions = {
    boxHeight: 10,
    boxWidth: 40
  };

  var gradient = ["#DEEBF7", "#4292C6", "#08306B"]
  var disabled = "#999";

  var svgDimensions = {
    width: d3.select("#india").style("width"),
    height: d3.select("#india").style("height")
  };

  var W = parseFloat(svgDimensions.width.substr(0, svgDimensions.width.length - 2))
  var H = parseFloat(svgDimensions.height.substr(0, svgDimensions.height.length - 2))

  var svg = d3.select("#india");

  var map = svg.append("g")
    .attr("class", "map")
    .attr("transform", "translate(-50, 0)");

  var legend = svg.append("g")
    .attr("class", "legend")
    .attr("transform", "translate("+ (W-((legendDimensions.boxWidth*divisions) + 20)) +","+ (H-150) +")");


  /* SCALES */
  var threshold = d3.scale.linear()
    .domain(d3.range(regionwise_min, regionwise_max, regionwise_max/divisions))
    .range(gradient)

  var invertThreshold = d3.scale.linear()
    .domain([regionwise_min, regionwise_max])
    .range([0, legendDimensions.boxWidth*divisions]);
  /* END SCALES */

  var xAxis = d3.svg.axis()
    .orient("bottom")
    .scale(invertThreshold)
    .tickValues(threshold.domain());

  legend.selectAll("rect")
    .data(d3.range(0, regionwise_max, regionwise_max/divisions)).enter()
    .append("rect")
    .attr("height", legendDimensions.boxHeight)
    .attr("x", function(d, i) { return i*legendDimensions.boxWidth; })
    .attr("width", legendDimensions.boxWidth)
    .attr("fill", function(d) { return threshold(d); });

  legend.append("g")
    .attr("transform", "translate(0, "+ legendDimensions.boxHeight +")")
    .attr("class", "x axis")
    .call(xAxis);

  d3.json("india-states-coords.json", function(error, coords) {
    if(error) return console.error(error);

    var shape = topojson.feature(coords, d3.values(coords.objects)[0]);

    states = G.map()
      .width(W)
      .height(H)
      .shape(shape)
      .map(map)

    states.attr("fill", function(d) {
      if(regionwise[d.properties.ST_ID])
        return threshold(regionwise[d.properties.ST_ID]);
        // return "#f00";
      return disabled;
    });

  });


  </script>
</body>
</head>
</html>