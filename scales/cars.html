<!doctype html>
<html>
<head>
  <style type="text/css">
    svg { width: 900px; height: 500px; }
  </style>
  <title>Cars</title>
</head>
<body>
<svg></svg>
<script type="text/javascript" src="d3-3.5.7.min.js"></script>
<script type="text/javascript">

var svg = d3.select('svg');

d3.json('cars.json', function(cars) {

  var brandWiseCars = d3.nest()
    .key(function(d) { return d.name.split(' ')[0]; })
    .entries(cars);

  // We are looking at brand wise car ratings
  //  so, on x-scale we will have all the brands as bars &
  //  y-axis will have the 0-5 ratings


  var brands = d3.map(brandWiseCars, function(d) { return d.key }).keys();
  // console.log(brandWiseCars);

  var xScale = d3.scale.ordinal()
    .domain(brands)
    .rangeBands([0, 800], 0.1, 0);

  var xAxis = d3.svg.axis().scale(xScale)
    .orient("bottom").ticks(8);


  var yScale = d3.scale.linear()
    .domain([0, 5])
    .range([0, 300]);

  // Always keep a group element for easy svg dom manipulation
  var bar = svg.selectAll('g')
    .data(brandWiseCars)
    .enter()
    .append('g')
    .attr('transform', function(d) { return 'translate('+ xScale(d.key) +', 0)'; })
    // Also note, always call the axes method on the 'g' element not on the 'rect' element.
    .call(xAxis)

  // Have the with and height attr assigned to the 'rect' and not the 'g'
  bar.append('rect')
    .attr('width', xScale.rangeBand())
    .attr('height', function(d) { return yScale(d3.mean(d.values, function(d) { return +d.rating }))})
    .attr('fill', 'green');


  // Always append 'text' to the 'g' not to the 'rect' element.
  bar.append('text')
    .text(function(d) { return d.key; })
    .attr('dy', '0.35em')
    .attr('x', xScale.rangeBand() - 20)
    .attr('y', function(d) { return yScale(d3.mean(d.values, function(d) { return +d.rating })) - 10; })
    .attr('fill', '#000');
});

</script>
</body>
</html>